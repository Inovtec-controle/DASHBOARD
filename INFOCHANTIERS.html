<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Fiche Chantiers ‚Äì √âdition & Cahier des charges</title>

  <!-- iPhone friendly -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#16a34a">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0f172a;
      --bg-elevated: #020617;
      --bg-soft: #020617;
      --bg-softer: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,.12);
      --accent-soft-strong: rgba(34,197,94,.22);
      --accent-border: rgba(34,197,94,.45);
      --accent-border-strong: rgba(34,197,94,.8);
      --accent-muted: #bbf7d0;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --text-softer: #6b7280;
      --border-subtle: rgba(31,41,55,.85);
      --border-strong: rgba(55,65,81,1);
      --shadow-soft: 0 18px 35px rgba(15,23,42,.95);
      --radius-lg: 22px;
      --radius-xl: 26px;
      --radius-full: 999px;
      --danger: #f97373;
      --danger-soft: rgba(248,113,113,.14);
      --danger-border: rgba(248,113,113,.7);
      --warning: #facc15;
      --warning-soft: rgba(234,179,8,.1);
      --input-bg: rgba(15,23,42,.86);
      --input-border: rgba(148,163,184,.2);
      --input-border-strong: rgba(148,163,184,.55);
      --pill-bg: rgba(15,23,42,.9);
    }

    body {
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,.16) 0, transparent 50%),
        radial-gradient(circle at 100% 0, rgba(52,211,153,.18) 0, transparent 50%),
        radial-gradient(circle at 50% 120%, rgba(129,140,248,.18) 0, transparent 55%),
        #020617;
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 18px 10px 22px;
    }

    .app-frame {
      width: 100%;
      max-width: 1120px;
      background: radial-gradient(circle at top left, rgba(248,250,252,.02) 0, transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15,23,42,.5) 0, transparent 55%),
                  rgba(15,23,42,.96);
      border-radius: 28px;
      border: 1px solid rgba(148,163,184,.40);
      box-shadow:
        0 32px 80px rgba(15,23,42,.96),
        0 0 0 1px rgba(15,23,42,.8),
        0 0 0 1px rgba(15,23,42,.6) inset;
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .app-frame::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(120deg, rgba(34,197,94,.12), transparent 40%, rgba(59,130,246,.10));
      opacity: 0.32;
      pointer-events: none;
      mix-blend-mode: soft-light;
    }

    .app-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100%;
      max-height: calc(100vh - 52px);
    }

    .app-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 6px 6px 4px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(34,197,94,.12) 0, transparent 60%),
                  rgba(15,23,42,.92);
      border: 1px solid rgba(55,65,81,.9);
      box-shadow:
        0 14px 35px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,.9) inset;
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 4px 10px 4px 5px;
      border-radius: 999px;
      background: rgba(15,23,42,.95);
      border: 1px solid rgba(31,41,55,.9);
      box-shadow: 0 8px 25px rgba(15,23,42,.85);
    }

    .logo-badge {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, #bbf7d0 0, rgba(187,247,208,.0) 45%),
        radial-gradient(circle at 70% 80%, #22c55e 0, rgba(34,197,94,0) 55%),
        radial-gradient(circle at 50% 50%, #15803d 0, #052e16 60%);
      border: 1px solid rgba(16,185,129, .9);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(15,23,42,.9),
        0 12px 35px rgba(22,163,74,.7);
      position: relative;
      overflow: hidden;
    }

    .logo-badge::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      background:
        radial-gradient(circle at 20% 0, rgba(248,250,252,.65) 0, transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(22,163,74,.7) 0, transparent 60%);
      mix-blend-mode: screen;
      opacity: .55;
    }

    .logo-badge-inner {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1px;
    }

    .logo-badge-icon {
      font-size: 16px;
      font-weight: 800;
      letter-spacing: .02em;
      color: #ecfdf5;
      text-shadow:
        0 0 16px rgba(74,222,128,1),
        0 0 4px rgba(15,23,42,1);
    }

    .logo-pulse-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #bbf7d0;
      box-shadow: 0 0 16px rgba(74,222,128,1);
      animation: pulseDot 2s ease-out infinite;
    }

    @keyframes pulseDot {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      70% {
        transform: scale(2.4);
        opacity: 0;
      }
      100% {
        transform: scale(2.6);
        opacity: 0;
      }
    }

    .app-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title-main {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .app-title-text {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: .04em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .app-title-pill {
      font-size: 11px;
      padding: 2px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.7);
      background: rgba(15,23,42,.9);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,1);
    }

    .app-title-subline {
      font-size: 12px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .divider-dot {
      width: 3px;
      height: 3px;
      border-radius: 999px;
      background: rgba(148,163,184,.9);
    }

    .app-header-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill-info {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,.9);
      border: 1px solid rgba(55,65,81,1);
      color: #d1d5db;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-info-icon {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.7);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #9ca3af;
      background: rgba(15,23,42,1);
    }

    .pill-info-label {
      opacity: .9;
    }

    .pill-info-strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .app-header-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,.55);
      background: radial-gradient(circle at 0 0, rgba(34,197,94,.22) 0, transparent 60%),
                  rgba(15,23,42,.95);
      color: #bbf7d0;
      font-size: 11px;
      box-shadow:
        0 0 18px rgba(22,163,74,.6),
        0 0 0 1px rgba(15,23,42,.9) inset;
    }

    .app-header-badge-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: rgba(21,128,61,.8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      box-shadow: 0 0 10px rgba(34,197,94,1);
    }

    .app-header-badge-label {
      text-transform: uppercase;
      letter-spacing: .08em;
      font-weight: 600;
      font-size: 10px;
    }

    .app-main {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .app-toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 10px;
      background: radial-gradient(circle at 0 0, rgba(15,23,42,.9) 0, rgba(15,23,42,.9) 55%, transparent 60%),
                  rgba(15,23,42,.92);
      border-radius: 999px;
      border: 1px solid rgba(31,41,55,1);
      box-shadow:
        0 12px 28px rgba(15,23,42,.9),
        0 0 0 1px rgba(15,23,42,.85) inset;
    }

    .search-group {
      flex: 1.1;
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(15,23,42,.96);
      border-radius: 999px;
      padding: 3px 8px 3px 6px;
      border: 1px solid rgba(31,41,55,1);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset;
    }

    .search-icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,.85) 0, transparent 70%),
                  rgba(15,23,42,1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #e5e7eb;
      border: 1px solid rgba(55,65,81,1);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 10px 22px rgba(15,23,42,.9);
    }

    .search-input-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .search-input-wrapper input {
      width: 100%;
      border: none;
      outline: none;
      font-size: 13px;
      padding: 5px 4px;
      background: transparent;
      color: #e5e7eb;
    }

    .search-input-wrapper input::placeholder {
      color: #6b7280;
    }

    .search-shortcut {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      font-size: 10px;
      color: #9ca3af;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,.95);
    }

    .toolbar-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .select-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px 4px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,1);
      border: 1px solid rgba(31,41,55,1);
      box-shadow: 0 0 0 1px rgba(15,23,42,1) inset;
      font-size: 11px;
      color: #e5e7eb;
    }

    .select-pill label {
      font-size: 11px;
      color: #9ca3af;
    }

    .select-pill select {
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      font-size: 11px;
      padding: 3px 0;
    }

    .select-pill select option {
      background: #020617;
      color: #e5e7eb;
    }

    .pill-divider {
      width: 1px;
      height: 16px;
      background: linear-gradient(to bottom, transparent, rgba(55,65,81,1), transparent);
    }

    .pill-kpi {
      display: inline-flex;
      align-items: baseline;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,1);
      border: 1px solid rgba(31,41,55,1);
      color: #e5e7eb;
      font-size: 11px;
    }

    .pill-kpi strong {
      font-size: 13px;
      font-weight: 600;
      color: #bbf7d0;
    }

    .pill-kpi-label {
      font-size: 10px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .toolbar-spacer {
      flex: 1;
    }

    .toolbar-legend {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,1);
      border: 1px solid rgba(31,41,55,1);
      font-size: 10px;
      color: #9ca3af;
    }

    .legend-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
    }

    .legend-chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,1);
    }

    .legend-chip-dot-warning {
      background: #facc15;
      box-shadow: 0 0 10px rgba(234,179,8,1);
    }

    .legend-chip-dot-danger {
      background: #f97316;
      box-shadow: 0 0 10px rgba(249,115,22,1);
    }

    .legend-chip-label {
      font-size: 10px;
      color: #d1d5db;
    }

    .app-content {
      flex: 1;
      min-height: 0;
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.55fr);
      gap: 12px;
      margin-top: 2px;
    }

    .panel {
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: 0;
      background:
        radial-gradient(circle at top center, rgba(15,23,42,.95) 0, rgba(15,23,42,.95) 50%, transparent 60%),
        rgba(15,23,42,.96);
      border-radius: 26px;
      border: 1px solid rgba(31,41,55,1);
      box-shadow:
        0 22px 55px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(34,197,94,.16) 0, transparent 50%),
        radial-gradient(circle at 100% 0, rgba(59,130,246,.15) 0, transparent 50%);
      opacity: .28;
      pointer-events: none;
      mix-blend-mode: soft-light;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      height: 100%;
    }

    .panel-header {
      padding: 10px 14px 8px;
      border-bottom: 1px solid rgba(31,41,55,1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: #d1d5db;
    }

    .panel-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .panel-tag {
      margin-left: auto;
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,.9);
      border: 1px solid rgba(55,65,81,1);
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .panel-tag strong {
      font-size: 11px;
      color: #e5e7eb;
      font-weight: 500;
    }

    .panel-body {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      padding: 8px 10px 10px;
      gap: 6px;
    }

    .liste-container {
      flex: 1;
      min-height: 0;
      border-radius: 18px;
      border: 1px solid rgba(31,41,55,1);
      background: radial-gradient(circle at 0 0, rgba(15,23,42,.95) 0, rgba(15,23,42,.95) 50%, transparent 60%),
                  rgba(15,23,42,.98);
      box-shadow:
        0 18px 45px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      padding: 4px;
      display: flex;
      flex-direction: column;
    }

    .liste-header {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px 4px;
      border-bottom: 1px solid rgba(31,41,55,1);
    }

    .liste-header-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: #9ca3af;
    }

    .liste-header-count {
      font-size: 11px;
      color: #e5e7eb;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
    }

    .liste-header-spacer {
      flex: 1;
    }

    .liste-header-badge {
      font-size: 10px;
      color: #9ca3af;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .liste-header-badge span {
      color: #e5e7eb;
    }

    .liste-scroll {
      flex: 1;
      min-height: 0;
      overflow: auto;
      padding: 2px 2px 2px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      scrollbar-width: thin;
      scrollbar-color: rgba(148,163,184,.6) rgba(15,23,42,1);
    }

    .liste-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .liste-scroll::-webkit-scrollbar-track {
      background: rgba(15,23,42,1);
      border-radius: 999px;
    }

    .liste-scroll::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,.7);
      border-radius: 999px;
    }

    .chantier-item {
      border-radius: 14px;
      padding: 7px 8px;
      background: radial-gradient(circle at 0 0, rgba(15,23,42,1) 0, rgba(15,23,42,1) 50%, transparent 60%),
                  linear-gradient(135deg, rgba(15,23,42,1), rgba(15,23,42,.98));
      border: 1px solid rgba(31,41,55,1);
      box-shadow:
        0 10px 22px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      display: flex;
      flex-direction: column;
      gap: 3px;
      cursor: pointer;
      transition: border-color .16s ease-out, box-shadow .16s ease-out, background .16s ease-out, transform .1s ease-out;
      position: relative;
      overflow: hidden;
    }

    .chantier-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(120deg, rgba(34,197,94,.12), transparent 40%, rgba(59,130,246,.10));
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease-out;
    }

    .chantier-item:hover {
      border-color: rgba(55,65,81,1);
      box-shadow:
        0 16px 32px rgba(15,23,42,.96),
        0 0 0 1px rgba(15,23,42,1) inset;
      transform: translateY(-1px);
    }

    .chantier-item:hover::before {
      opacity: 1;
    }

    .chantier-item.selected {
      border-color: var(--accent-border-strong);
      box-shadow:
        0 0 0 1px rgba(21,128,61,1),
        0 16px 38px rgba(22,163,74,.85);
      background:
        radial-gradient(circle at 0 0, rgba(34,197,94,.22) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(59,130,246,.16) 0, transparent 55%),
        linear-gradient(135deg, rgba(15,23,42,1), rgba(15,23,42,1));
    }

    .chantier-item.selected::before {
      opacity: .85;
      mix-blend-mode: soft-light;
    }

    .chantier-item-header {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chantier-item-title {
      font-size: 13px;
      font-weight: 600;
      color: #e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chantier-item-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chantier-item-subline {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      color: #9ca3af;
    }

    .chantier-item-subline span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .note-pill {
      margin-left: auto;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(55,65,81,1);
    }

    .note-good {
      color: #bbf7d0;
      border-color: rgba(34,197,94,.75);
      background: rgba(22,163,74,.18);
      box-shadow: 0 0 0 1px rgba(15,23,42,1) inset;
    }

    .note-medium {
      color: #facc15;
      border-color: rgba(234,179,8,.8);
      background: rgba(234,179,8,.16);
      box-shadow: 0 0 0 1px rgba(15,23,42,1) inset;
    }

    .note-low {
      color: #fb923c;
      border-color: rgba(249,115,22,.8);
      background: rgba(249,115,22,.16);
      box-shadow: 0 0 0 1px rgba(15,23,42,1) inset;
    }

    .detail-container {
      flex: 1;
      min-height: 0;
      border-radius: 18px;
      border: 1px solid rgba(31,41,55,1);
      background:
        radial-gradient(circle at 0 0, rgba(15,23,42,.95) 0, rgba(15,23,42,.95) 50%, transparent 60%),
        rgba(15,23,42,.98);
      box-shadow:
        0 18px 45px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      padding: 6px 6px 7px;
      display: flex;
      flex-direction: column;
    }

    .detail-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 2px 2px 6px;
      border-bottom: 1px solid rgba(31,41,55,1);
    }

    .detail-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .detail-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: #d1d5db;
    }

    .detail-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .detail-kpi-group {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      font-size: 11px;
      color: #9ca3af;
    }

    .chip-label {
      color: #e5e7eb;
    }

    .chip-kpi {
      font-size: 13px;
      font-weight: 600;
      color: #bbf7d0;
    }

    .detail-body {
      flex: 1;
      min-height: 0;
      margin-top: 5px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 8px;
    }

    .field-section {
      border-radius: 16px;
      border: 1px solid rgba(31,41,55,1);
      background: radial-gradient(circle at 0 0, rgba(15,23,42,.96) 0, rgba(15,23,42,.96) 50%, transparent 60%),
                  rgba(15,23,42,.98);
      padding: 7px 7px 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-section-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 2px;
    }

    .field-section-title {
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: #9ca3af;
    }

    .field-section-tag {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      color: #9ca3af;
    }

    .field-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 4px;
    }

    .field-full {
      grid-column: 1 / -1;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .field-label {
      font-size: 11px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .field-label span {
      color: #e5e7eb;
    }

    .field-label-badge {
      font-size: 9px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,.9);
      color: #9ca3af;
    }

    .field-input, .field-textarea, .field-select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: #e5e7eb;
      font-size: 12px;
      padding: 5px 9px;
      outline: none;
      transition: border-color .16s ease-out, box-shadow .16s ease-out, background .16s ease-out;
      box-shadow: 0 0 0 1px rgba(15,23,42,1) inset;
    }

    .field-input:focus,
    .field-textarea:focus,
    .field-select:focus {
      border-color: var(--accent-border-strong);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 0 0 1px rgba(22,163,74,.9);
      background: rgba(15,23,42,1);
    }

    .field-input::placeholder,
    .field-textarea::placeholder {
      color: #6b7280;
    }

    .field-textarea {
      min-height: 54px;
      border-radius: 12px;
      resize: vertical;
      padding: 6px 8px;
    }

    .field-select {
      padding-right: 24px;
      background-image: linear-gradient(45deg, transparent 50%, #9ca3af 50%),
                        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position: calc(100% - 11px) 10px, calc(100% - 7px) 10px;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
      appearance: none;
    }

    .field-select option {
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
    }

    .field-helper {
      font-size: 10px;
      color: #6b7280;
    }

    .badge-inline {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      font-size: 9px;
      color: #9ca3af;
    }

    .badge-inline strong {
      color: #e5e7eb;
    }

    .note-input {
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      text-align: center;
    }

    .note-input.good {
      color: #bbf7d0;
      border-color: rgba(34,197,94,.85);
      background: rgba(21,128,61,.35);
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 0 18px rgba(22,163,74,.7);
    }

    .note-input.medium {
      color: #facc15;
      border-color: rgba(234,179,8,.9);
      background: rgba(202,138,4,.35);
    }

    .note-input.low {
      color: #fb923c;
      border-color: rgba(249,115,22,.9);
      background: rgba(194,65,12,.35);
    }

    .cahier-section {
      margin-top: 4px;
      padding-top: 5px;
      border-top: 1px dashed rgba(55,65,81,1);
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .cahier-title {
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cahier-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,1);
      background: rgba(15,23,42,1);
      color: #9ca3af;
    }

    .cahier-controls {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .cahier-file-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cahier-file-row input[type="file"] {
      flex: 1;
      font-size: 11px;
      color: #9ca3af;
    }

    .cahier-info {
      font-size: 10px;
      color: #6b7280;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .save-button {
      border-radius: 999px;
      border: 1px solid var(--accent-border);
      background: radial-gradient(circle at 0 0, rgba(74,222,128,.22) 0, transparent 55%),
                  rgba(22,163,74,.9);
      color: #ecfdf5;
      font-size: 11px;
      font-weight: 500;
      padding: 5px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 18px 30px rgba(22,163,74,.65);
      transition: transform .1s ease-out, box-shadow .12s ease-out, background .12s ease-out, border-color .12s ease-out;
    }

    .save-button:hover {
      transform: translateY(-1px);
      box-shadow:
        0 22px 35px rgba(22,163,74,.85),
        0 0 0 1px rgba(15,23,42,1) inset;
      background:
        radial-gradient(circle at 0 0, rgba(74,222,128,.3) 0, transparent 60%),
        rgba(21,128,61,1);
      border-color: rgba(34,197,94,1);
    }

    .save-button:active {
      transform: translateY(0);
      box-shadow:
        0 12px 24px rgba(22,163,74,.7),
        0 0 0 1px rgba(15,23,42,1) inset;
    }

    .save-button--secondary {
      background: rgba(15,23,42,1);
      border-color: rgba(55,65,81,1);
      color: #e5e7eb;
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 12px 24px rgba(15,23,42,.9);
    }

    .save-button--secondary:hover {
      border-color: rgba(148,163,184,.9);
      box-shadow:
        0 16px 28px rgba(15,23,42,.95),
        0 0 0 1px rgba(15,23,42,1) inset;
      background:
        radial-gradient(circle at 0 0, rgba(148,163,184,.28) 0, transparent 60%),
        rgba(15,23,42,1);
    }

    .save-button--danger {
      background: var(--danger-soft);
      border-color: var(--danger-border);
      color: #fecaca;
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 12px 26px rgba(127,29,29,.9);
    }

    .save-button--danger:hover {
      background: rgba(127,29,29,1);
      border-color: #fecaca;
      box-shadow:
        0 18px 32px rgba(127,29,29,1),
        0 0 0 1px rgba(15,23,42,1) inset;
    }

    .save-button[disabled],
    .save-button:disabled {
      opacity: .55;
      cursor: not-allowed;
      box-shadow:
        0 0 0 1px rgba(15,23,42,1) inset,
        0 10px 20px rgba(15,23,42,.85);
    }

    .save-status {
      margin-top: 5px;
      font-size: 11px;
      color: #9ca3af;
      min-height: 14px;
    }

    .detail-footer {
      margin-top: 8px;
      padding-top: 6px;
      border-top: 1px solid rgba(31,41,55,1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .detail-footer--centered {
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }

    .detail-footer-left {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #6b7280;
    }

    .detail-footer-left .dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148,163,184,.9);
    }

    .detail-footer-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .app-footer-note {
      font-size: 11px;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      padding: 0 4px;
    }

    .app-footer-note span:last-child {
      font-size: 10px;
      color: #4b5563;
    }

    input, select, textarea, button {
      font-family: inherit;
    }

    @media (max-width: 960px) {
      .app-frame {
        max-width: 100%;
        padding: 12px 10px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }

      .app-inner {
        max-height: none;
      }

      .app-content {
        grid-template-columns: minmax(0, 1fr);
      }

      .detail-body {
        grid-template-columns: minmax(0, 1fr);
      }

      .app-toolbar {
        flex-wrap: wrap;
      }

      .toolbar-spacer {
        display: none;
      }

      .toolbar-legend {
        margin-left: auto;
      }
    }

    @media (max-width: 720px) {
      .app-header {
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .app-header-right {
        margin-left: 0;
        margin-top: 4px;
      }

      .detail-kpi-group {
        display: none;
      }

      .panel-tag {
        display: none;
      }

      .toolbar-legend {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .app-shell {
        padding: 8px 0 12px;
      }

      .app-frame {
        padding: 10px 8px 10px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }

      .app-toolbar {
        padding: 6px 8px;
      }

      .search-group {
        padding-inline: 8px;
      }

      .panel-header {
        padding-inline: 10px;
      }

      .panel-body {
        padding-inline: 9px;
      }

      .detail-container {
        padding-inline: 6px;
      }

      .field-section {
        padding-inline: 7px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="app-frame">
      <div class="app-inner">
        <header class="app-header">
          <div class="app-header-left">
            <div class="logo-badge">
              <div class="logo-badge-inner">
                <div class="logo-badge-icon">CHT</div>
                <div class="logo-pulse-dot"></div>
              </div>
            </div>
            <div class="app-title-block">
              <div class="app-title-main">
                <div class="app-title-text">Chantiers ‚Äì Fiches & Cahier</div>
                <div class="app-title-pill">
                  <span class="badge-dot"></span>
                  <span>Mode √©dition & suivi</span>
                </div>
              </div>
              <div class="app-title-subline">
                <span>Base centralis√©e des sites √† contr√¥ler</span>
                <span class="divider-dot"></span>
                <span>Mise √† jour directe sur l‚Äôappareil</span>
              </div>
            </div>
          </div>

          <div class="app-header-right">
            <div class="pill-info">
              <div class="pill-info-icon">i</div>
              <div class="pill-info-label">
                Donn√©es stock√©es <span class="pill-info-strong">en local sur ce t√©l√©phone</span>
              </div>
            </div>
            <div class="app-header-badge">
              <div class="app-header-badge-icon">‚úì</div>
              <div class="app-header-badge-label">Edition s√©curis√©e</div>
            </div>
          </div>
        </header>

        <main class="app-main">
          <section class="app-toolbar">
            <div class="search-group">
              <div class="search-icon">‚åï</div>
              <div class="search-input-wrapper">
                <input type="text" id="searchInput" placeholder="Rechercher un chantier (r√©sidence, adresse, syndic, agent‚Ä¶)" />
                <div class="search-shortcut">
                  <span>Filtre instantan√©</span>
                </div>
              </div>
            </div>

            <div class="toolbar-group">
              <div class="select-pill">
                <label for="syndicFilter">Syndic</label>
                <select id="syndicFilter">
                  <option value="">Tous</option>
                </select>
              </div>

              <div class="select-pill">
                <label for="triSelect">Tri</label>
                <div class="pill-divider"></div>
                <select id="triSelect">
                  <option value="alpha">Nom (A ‚Üí Z)</option>
                  <option value="note">Note (meilleure ‚Üí moins bonne)</option>
                  <option value="syndic">Syndic + Nom</option>
                </select>
              </div>
            </div>

            <div class="toolbar-spacer"></div>

            <div class="toolbar-legend">
              <span>L√©gende note :</span>
              <div class="legend-chip">
                <div class="legend-chip-dot"></div>
                <div class="legend-chip-label">‚â• 90</div>
              </div>
              <div class="legend-chip">
                <div class="legend-chip-dot-warning"></div>
                <div class="legend-chip-label">75 ‚Üí 89</div>
              </div>
              <div class="legend-chip">
                <div class="legend-chip-dot-danger"></div>
                <div class="legend-chip-label">&lt; 75</div>
              </div>
            </div>
          </section>

          <section class="app-content">
            <div class="panel">
              <div class="panel-inner">
                <header class="panel-header">
                  <div>
                    <div class="panel-title">Liste des chantiers</div>
                    <div class="panel-subtitle">S√©lectionne un site pour afficher et modifier la fiche d√©taill√©e</div>
                  </div>
                  <div class="panel-tag">
                    <span>üåê Vue globale</span>
                    <span>Tap pour √©diter √† droite</span>
                  </div>
                </header>

                <div class="panel-body">
                  <div class="liste-container">
                    <div class="liste-header">
                      <div class="liste-header-title">Sites enregistr√©s</div>
                      <div class="liste-header-count" id="listeCount">0 chantiers</div>
                      <div class="liste-header-spacer"></div>
                      <div class="liste-header-badge">
                        <span>Filtre en temps r√©el</span>
                      </div>
                    </div>
                    <div class="liste-scroll" id="listeChantiers">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-inner">
                <header class="panel-header">
                  <div class="detail-title-block">
                    <div class="detail-title">Fiche chantier s√©lectionn√©</div>
                    <div class="detail-subtitle">Toutes les informations sont modifiables pour ce chantier uniquement</div>
                  </div>
                  <div class="detail-kpi-group">
                    <div class="chip">
                      <span class="chip-label">Note actuelle :</span>
                      <span class="chip-kpi" id="noteKpi">‚Äì</span>
                    </div>
                    <div class="chip">
                      <span class="chip-label">Cl√© :</span>
                      <span id="cleKpi">‚Äì</span>
                    </div>
                  </div>
                </header>

                <div class="panel-body detail-container">
                  <div class="detail-body">
                    <div class="field-section">
                      <div class="field-section-header">
                        <div class="field-section-title">Identification du site</div>
                        <div class="field-section-tag">Coordonn√©es de base</div>
                      </div>

                      <div class="field-grid">
                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Nom de la r√©sidence / site</span>
                          </label>
                          <input type="text" id="infoResidence" class="field-input" placeholder="Ex : R√©sidence Les Tilleuls" />
                        </div>

                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Adresse compl√®te</span>
                          </label>
                          <textarea id="infoAdresse" class="field-textarea" placeholder="N¬∞, rue, code postal, ville"></textarea>
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Syndic / gestionnaire</span>
                          </label>
                          <input type="text" id="infoSyndic" class="field-input" placeholder="Nom du syndic" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>N¬∞ de cl√© / badge</span>
                          </label>
                          <input type="text" id="infoClef" class="field-input" placeholder="Ex : Cl√© n¬∞12 / Badge vert" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Contact principal</span>
                          </label>
                          <input type="text" id="infoContact" class="field-input" placeholder="Nom & fonction" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>T√©l√©phone</span>
                          </label>
                          <input type="tel" id="infoTelephone" class="field-input" placeholder="T√©l√©phone contact" />
                        </div>

                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Mail(s) principal(aux)</span>
                          </label>
                          <input type="text" id="infoMail" class="field-input" placeholder="adresse@mail.fr (s√©parer par des virgules si plusieurs)" />
                        </div>
                      </div>
                    </div>

                    <div class="field-section">
                      <div class="field-section-header">
                        <div class="field-section-title">Organisation & agents</div>
                        <div class="field-section-tag">Fr√©quences & √©quipes</div>
                      </div>

                      <div class="field-grid">
                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Intervention / type de prestation</span>
                          </label>
                          <textarea id="infoIntervention" class="field-textarea" placeholder="Ex : Entretien des communs, sortie OM, vitrerie, entretien espaces verts‚Ä¶"></textarea>
                        </div>

                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Jour de passage / t√¢ches d√©taill√©es</span>
                          </label>
                          <textarea id="infoJours" class="field-textarea" placeholder="Ex : Lundi & jeudi ‚Äì communs et escaliers, Mercredi ‚Äì vitres, etc."></textarea>
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Agent(s) d√©di√©(s) au site</span>
                          </label>
                          <input type="text" id="infoAgents" class="field-input" placeholder="Nom(s) de l‚Äôagent / des agents" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>N¬∞ de t√©l√©phone agent(s)</span>
                          </label>
                          <input type="text" id="infoNumAgents" class="field-input" placeholder="T√©l√©phone(s) des agents" />
                        </div>
                      </div>
                    </div>

                    <div class="field-section">
                      <div class="field-section-header">
                        <div class="field-section-title">Acc√®s & sorties</div>
                        <div class="field-section-tag">Code / OM / tri</div>
                      </div>

                      <div class="field-grid">
                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Code / clef d‚Äôacc√®s</span>
                          </label>
                          <input type="text" id="infoCodeClef" class="field-input" placeholder="Codes, instructions de badge, portail‚Ä¶" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Sortie OM</span>
                          </label>
                          <input type="text" id="infoSortieOm" class="field-input" placeholder="Jours, horaires, emplacement bacs OM" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Sortie TRI</span>
                          </label>
                          <input type="text" id="infoSortieTri" class="field-input" placeholder="Tri s√©lectif : consignes et emplacement" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Frange</span>
                          </label>
                          <input type="text" id="infoFrange" class="field-input" placeholder="Type / format frange utilis√©" />
                        </div>

                        <div class="field-group">
                          <label class="field-label">
                            <span>Type ampoules / n√©ons</span>
                          </label>
                          <input type="text" id="infoAmpoules" class="field-input" placeholder="R√©f√©rences, formats, particularit√©s" />
                        </div>

                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Sac poubelle</span>
                          </label>
                          <input type="text" id="infoSac" class="field-input" placeholder="Type, taille, couleur, quantit√© moyenne‚Ä¶" />
                        </div>

                        <div class="field-group field-full">
                          <label class="field-label">
                            <span>Note chantier</span>
                            <span class="field-label-badge">R√©f√©rence contr√¥le qualit√©</span>
                          </label>
                          <input type="number" id="infoNote" class="field-input note-input" placeholder="Ex : 95" />
                          <div class="field-helper">
                            <span class="badge-inline">
                              <span>üí°</span>
                              <span>La note globale atteindre afin d'avoir une bonne tenue de site est <strong>95%</strong>.</span>
                            </span>
                          </div>
                        </div>
                      </div>

                      <div class="cahier-section">
                        <div class="cahier-title">
                          <span>Cahier des charges PDF (par chantier)</span>
                          <span class="cahier-badge">1 fichier stock√© localement</span>
                        </div>
                        <div class="cahier-controls">
                          <div class="cahier-file-row">
                            <input type="file" id="infoCahierFile" accept="application/pdf" />
                          </div>
                          <div class="button-row">
                            <button type="button" id="openCahierBtn" class="save-button save-button--secondary">
                              Ouvrir le PDF
                            </button>
                            <button type="button" id="clearCahierBtn" class="save-button save-button--danger">
                              Supprimer
                            </button>
                            <div id="cahierInfo" class="cahier-info"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="detail-footer detail-footer--centered">
                    <!-- Boutons ajout / suppression de chantier -->
                    <div>
                      <button type="button" id="addChantierBtn" class="save-button save-button--secondary">
                        + Ajouter un chantier
                      </button>
                      <button type="button" id="deleteChantierBtn" class="save-button save-button--danger">
                        Supprimer ce chantier
                      </button>
                    </div>

                    <!-- Bouton d'enregistrement existant -->
                    <button type="button" id="saveButton" class="save-button">
                      <span>Enregistrer les modifications</span>
                    </button>

                    <div id="saveStatus" class="save-status"></div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>

        <footer class="app-footer-note">
          <span></span>
          <span></span>
        </footer>
      </div>
    </div>
  </div>

  <script>
    const CHANTIERS = [
      {
        "Nom de la r√©sidence": "LE RUBIS",
        "N¬∞ De Clef": "12",
        "Adresse": "Rue Jean Monnet\n31130 BALMA",
        "Contact": "Service technique",
        "T√©l√©phone": "05 61 24 36 84",
        "Mails": "gestionnaire@exemple.fr",
        "Syndic": "SERGIC",
        "Intervention": "Entretien des parties communes, sorties OM et tri s√©lectif.",
        "Agents": "Agent A",
        "Num√©ro Agents": "06 00 00 00 01",
        "Jour de passage /Tache": "Lundi et jeudi ‚Äì communs int√©rieurs\nMercredi ‚Äì vitrerie",
        "Code / clef": "#0123 puis B",
        "Sortie om": "Lundi et jeudi √† 18h (local sous-sol)",
        "Sortie tri": "Mercredi 18h (bacs jaunes)",
        "Frange": "Frange microfibre bleue",
        "type  ampoules n√©ons": "LED E14 et n√©ons T8 120cm",
        "sac poubelle": "50L noir renforc√© pour OM, 50L jaune pour tri",
        "Note chantier": "95"
      },
      {
        "Nom de la r√©sidence": "LES MAGNOLIAS",
        "N¬∞ De Clef": "7",
        "Adresse": "12 Avenue des Magnolias\n31500 TOULOUSE",
        "Contact": "Gardien",
        "T√©l√©phone": "05 61 00 00 00",
        "Mails": "contact@magnolias.fr",
        "Syndic": "3F",
        "Intervention": "Entretien des halls, escaliers et ascenseurs.",
        "Agents": "Agent B",
        "Num√©ro Agents": "06 00 00 00 02",
        "Jour de passage /Tache": "Mardi et vendredi ‚Äì communs / ascenseur",
        "Code / clef": "Interphone + badge rouge",
        "Sortie om": "Tous les jours √† 19h",
        "Sortie tri": "Mardi et vendredi √† 18h",
        "Frange": "Frange coton blanche",
        "type  ampoules n√©ons": "LED GU10 et tubes 90cm",
        "sac poubelle": "30L noir pour sanitaires, 50L noir pour communs",
        "Note chantier": "90"
      },
      {
        "Nom de la r√©sidence": "LES JARDINS D'EMMA",
        "N¬∞ De Clef": "3B",
        "Adresse": "4 rue des Jardins\n31200 TOULOUSE",
        "Contact": "Pr√©sident du conseil syndical",
        "T√©l√©phone": "06 00 00 00 03",
        "Mails": "cs@jardindemma.fr",
        "Syndic": "SERGIC",
        "Intervention": "Entretien complet, sortie OM/tri, gestion des encombrants.",
        "Agents": "Agent C",
        "Num√©ro Agents": "06 00 00 00 04",
        "Jour de passage /Tache": "Lundi, mercredi, vendredi",
        "Code / clef": "Cl√© + digicode",
        "Sortie om": "Lundi, mercredi, vendredi 19h",
        "Sortie tri": "Mercredi 19h",
        "Frange": "Frange microfibre verte",
        "type  ampoules n√©ons": "LED E27 et bandeaux LED",
        "sac poubelle": "50L noir, 30L transparents pour tri",
        "Note chantier": "88"
      }
    ];

    (function initLocalStorage(){
      try {
        const stored = localStorage.getItem("chantiersData_editable");
        if (stored) {
          const arr = JSON.parse(stored);
          if (Array.isArray(arr) && arr.length > 0) {
            for (let i = 0; i < arr.length && i < CHANTIERS.length; i++) {
              const base = CHANTIERS.findIndex(c => c["Nom de la r√©sidence"] === arr[i]["Nom de la r√©sidence"]);
              if (base >= 0) {
                CHANTIERS[base] = Object.assign({}, CHANTIERS[base], arr[i]);
              }
            }
          }
        }
      } catch (e) {
        console.warn("Impossible de lire les donn√©es locales :", e);
      }
    })();

    const listeChantiers = document.getElementById("listeChantiers");
    const listeCount = document.getElementById("listeCount");

    const searchInput = document.getElementById("searchInput");
    const syndicFilter = document.getElementById("syndicFilter");
    const triSelect = document.getElementById("triSelect");

    const infoResidence = document.getElementById("infoResidence");
    const infoAdresse = document.getElementById("infoAdresse");
    const infoSyndic = document.getElementById("infoSyndic");
    const infoClef = document.getElementById("infoClef");
    const infoContact = document.getElementById("infoContact");
    const infoTelephone = document.getElementById("infoTelephone");
    const infoMail = document.getElementById("infoMail");
    const infoIntervention = document.getElementById("infoIntervention");
    const infoJours = document.getElementById("infoJours");
    const infoAgents = document.getElementById("infoAgents");
    const infoNumAgents = document.getElementById("infoNumAgents");
    const infoCodeClef = document.getElementById("infoCodeClef");
    const infoSortieOm = document.getElementById("infoSortieOm");
    const infoSortieTri = document.getElementById("infoSortieTri");
    const infoFrange = document.getElementById("infoFrange");
    const infoAmpoules = document.getElementById("infoAmpoules");
    const infoSac = document.getElementById("infoSac");
    const infoNote = document.getElementById("infoNote");

    const infoCahierFile = document.getElementById("infoCahierFile");
    const openCahierBtn = document.getElementById("openCahierBtn");
    const clearCahierBtn = document.getElementById("clearCahierBtn");
    const cahierInfo = document.getElementById("cahierInfo");

    const saveButton = document.getElementById("saveButton");
    const saveStatus = document.getElementById("saveStatus");

    // Nouveaux boutons ajout / suppression de chantier
    const addChantierBtn = document.getElementById("addChantierBtn");
    const deleteChantierBtn = document.getElementById("deleteChantierBtn");

    const noteKpi = document.getElementById("noteKpi");
    const cleKpi = document.getElementById("cleKpi");

    let etat = {
      recherche: "",
      syndic: "",
      tri: "alpha",
      selectionIndex: null
    };

    function normaliserTexte(str){
      if (!str) return "";
      return String(str)
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");
    }

    function calculerClasseNote(noteStr){
      const n = parseFloat(noteStr);
      if (isNaN(n)) return "";
      if (n >= 90) return "good";
      if (n >= 75) return "medium";
      return "low";
    }

    function buildSyndicOptions(){
      const syndicSet = new Set();
      CHANTIERS.forEach(c => {
        if (c.Syndic && String(c.Syndic).trim() !== "") {
          syndicSet.add(String(c.Syndic).trim());
        }
      });
      const syndicArray = Array.from(syndicSet).sort((a,b) => a.localeCompare(b, "fr", { sensitivity: "base" }));
      syndicFilter.innerHTML = '<option value="">Tous</option>';
      syndicArray.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        syndicFilter.appendChild(opt);
      });
    }

    function getFilteredAndSortedIndices(){
      const indices = [];
      const search = normaliserTexte(etat.recherche);
      const filtreSyndic = etat.syndic;

      CHANTIERS.forEach((c, index) => {
        let keep = true;

        if (search) {
          const blocTexte = [
            c["Nom de la r√©sidence"],
            c["Adresse"],
            c["Syndic"],
            c["Contact"],
            c["Agents"],
            c["Jour de passage /Tache"]
          ].join(" ");
          const normalized = normaliserTexte(blocTexte);
          if (!normalized.includes(search)) {
            keep = false;
          }
        }

        if (keep && filtreSyndic) {
          if (!c.Syndic || String(c.Syndic).trim() !== filtreSyndic) {
            keep = false;
          }
        }

        if (keep) indices.push(index);
      });

      const tri = etat.tri;
      indices.sort((a, b) => {
        const ca = CHANTIERS[a];
        const cb = CHANTIERS[b];

        if (tri === "alpha") {
          const na = ca["Nom de la r√©sidence"] || "";
          const nb = cb["Nom de la r√©sidence"] || "";
          return na.localeCompare(nb, "fr", { sensitivity: "base" });
        }

        if (tri === "note") {
          const na = parseFloat(ca["Note chantier"] || "0");
          const nb = parseFloat(cb["Note chantier"] || "0");
          if (isNaN(na) && isNaN(nb)) return 0;
          if (isNaN(na)) return 1;
          if (isNaN(nb)) return -1;
          return nb - na;
        }

        if (tri === "syndic") {
          const sa = ca.Syndic || "";
          const sb = cb.Syndic || "";
          const cmp = sa.localeCompare(sb, "fr", { sensitivity: "base" });
          if (cmp !== 0) return cmp;
          const na = ca["Nom de la r√©sidence"] || "";
          const nb = cb["Nom de la r√©sidence"] || "";
          return na.localeCompare(nb, "fr", { sensitivity: "base" });
        }

        const na = ca["Nom de la r√©sidence"] || "";
        const nb = cb["Nom de la r√©sidence"] || "";
        return na.localeCompare(nb, "fr", { sensitivity: "base" });
      });

      return indices;
    }

    function renderListe(){
      const indices = getFilteredAndSortedIndices();
      listeChantiers.innerHTML = "";

      const count = indices.length;
      listeCount.textContent = count + (count <= 1 ? " chantier" : " chantiers");

      indices.forEach((idx) => {
        const c = CHANTIERS[idx];
        const item = document.createElement("div");
        item.className = "chantier-item";
        if (etat.selectionIndex === idx) {
          item.classList.add("selected");
        }

        const nom = c["Nom de la r√©sidence"] || "(Sans nom)";
        const syndic = c.Syndic || "‚Äî";
        const adresse = (c.Adresse || "").replace(/\n/g, " ");
        const contact = c.Contact || "Contact non renseign√©";
        const noteStr = c["Note chantier"] || "";
        const noteClass = calculerClasseNote(noteStr);
        const noteBadge = noteStr ? `<span class="note-pill note-${noteClass}">${noteStr}</span>` : "";

        item.innerHTML = `
          <div class="chantier-item-header">
            <div class="chantier-item-title">${nom}</div>
            <div class="chantier-item-badge">
              <span>üß≠</span>
              <span>${syndic}</span>
            </div>
          </div>
          <div class="chantier-item-subline">
            <span>${adresse || "Adresse non renseign√©e"}</span>
          </div>
          <div class="chantier-item-subline">
            <span>üë§ ${contact}</span>
            ${noteBadge}
          </div>
        `;

        item.addEventListener("click", () => {
          etat.selectionIndex = idx;
          renderListe();
          renderDetail();
        });

        listeChantiers.appendChild(item);
      });

      if (etat.selectionIndex === null && indices.length > 0) {
        etat.selectionIndex = indices[0];
        renderListe();
        renderDetail();
      }
    }

    function renderDetail(){
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length) {
        infoResidence.value = "";
        infoAdresse.value = "";
        infoSyndic.value = "";
        infoClef.value = "";
        infoContact.value = "";
        infoTelephone.value = "";
        infoMail.value = "";
        infoIntervention.value = "";
        infoJours.value = "";
        infoAgents.value = "";
        infoNumAgents.value = "";
        infoCodeClef.value = "";
        infoSortieOm.value = "";
        infoSortieTri.value = "";
        infoFrange.value = "";
        infoAmpoules.value = "";
        infoSac.value = "";
        infoNote.value = "";

        noteKpi.textContent = "‚Äì";
        cleKpi.textContent = "‚Äì";
        infoNote.classList.remove("good","medium","low");

        updateCahierUI();
        saveStatus.textContent = "";
        return;
      }

      const c = CHANTIERS[idx];

      infoResidence.value = c["Nom de la r√©sidence"] || "";
      infoAdresse.value = c["Adresse"] || "";
      infoSyndic.value = c.Syndic || "";
      infoClef.value = c["N¬∞ De Clef"] || "";
      infoContact.value = c.Contact || "";
      infoTelephone.value = c["T√©l√©phone"] || "";
      infoMail.value = c["Mails"] || "";
      infoIntervention.value = c["Intervention"] || "";
      infoJours.value = c["Jour de passage /Tache"] || "";
      infoAgents.value = c["Agents"] || "";
      infoNumAgents.value = c["Num√©ro Agents"] || "";
      infoCodeClef.value = c["Code / clef"] || "";
      infoSortieOm.value = c["Sortie om"] || "";
      infoSortieTri.value = c["Sortie tri"] || "";
      infoFrange.value = c["Frange"] || "";
      infoAmpoules.value = c["type  ampoules n√©ons"] || "";
      infoSac.value = c["sac poubelle"] || "";
      infoNote.value = c["Note chantier"] || "";

      noteKpi.textContent = c["Note chantier"] || "‚Äì";
      cleKpi.textContent = c["N¬∞ De Clef"] || "‚Äì";

      infoNote.classList.remove("good","medium","low");
      const noteClass = calculerClasseNote(c["Note chantier"]);
      if (noteClass) {
        infoNote.classList.add(noteClass);
      }

      updateCahierUI();
      saveStatus.textContent = "";
    }

    function sauvegarderSelection(){
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length){
        saveStatus.textContent = "Aucun chantier s√©lectionn√©.";
        return;
      }
      const c = CHANTIERS[idx];

      c["Nom de la r√©sidence"] = infoResidence.value.trim();
      c["Adresse"] = infoAdresse.value.trim();
      c["Syndic"] = infoSyndic.value.trim();

      c["N¬∞ De Clef"] = infoClef.value.trim();
      c["Contact"] = infoContact.value.trim();
      c["T√©l√©phone"] = infoTelephone.value.trim();
      c["Mails"] = infoMail.value.trim();

      c["Intervention"] = infoIntervention.value.trim();
      c["Jour de passage /Tache"] = infoJours.value.trim();
      c["Agents"] = infoAgents.value.trim();
      c["Num√©ro Agents"] = infoNumAgents.value.trim();

      c["Code / clef"] = infoCodeClef.value.trim();
      c["Sortie om"] = infoSortieOm.value.trim();
      c["Sortie tri"] = infoSortieTri.value.trim();
      c["Frange"] = infoFrange.value.trim();
      c["type  ampoules n√©ons"] = infoAmpoules.value.trim();
      c["sac poubelle"] = infoSac.value.trim();

      c["Note chantier"] = infoNote.value.trim();
      const noteClass = calculerClasseNote(c["Note chantier"]);
      infoNote.classList.remove("good","medium","low");
      if (noteClass) infoNote.classList.add(noteClass);

      noteKpi.textContent = c["Note chantier"] || "‚Äì";
      cleKpi.textContent = c["N¬∞ De Clef"] || "‚Äì";

      try {
        localStorage.setItem("chantiersData_editable", JSON.stringify(CHANTIERS));
        saveStatus.textContent = "Modifications enregistr√©es pour ce chantier.";
      } catch (e) {
        console.warn("Impossible d'enregistrer les modifications :", e);
        saveStatus.textContent = "Erreur : impossible d'enregistrer les modifications (stockage local indisponible).";
      }

      renderListe();
    }

    function ajouterChantier(){
      const nouveau = {
        "Nom de la r√©sidence": "Nouveau chantier",
        "N¬∞ De Clef": "",
        "Adresse": "",
        "Contact": "",
        "T√©l√©phone": "",
        "Mails": "",
        "Syndic": "",
        "Intervention": "",
        "Agents": "",
        "Num√©ro Agents": "",
        "Jour de passage /Tache": "",
        "Code / clef": "",
        "Sortie om": "",
        "Sortie tri": "",
        "Frange": "",
        "type  ampoules n√©ons": "",
        "sac poubelle": "",
        "Note chantier": ""
      };

      CHANTIERS.push(nouveau);
      etat.selectionIndex = CHANTIERS.length - 1;

      try {
        localStorage.setItem("chantiersData_editable", JSON.stringify(CHANTIERS));
      } catch (e) {
        console.warn("Impossible d'enregistrer en localStorage :", e);
      }

      buildSyndicOptions();
      renderListe();
      renderDetail();
      saveStatus.textContent = "Nouveau chantier cr√©√©. Remplis les champs puis clique sur ¬´ Enregistrer les modifications ¬ª.";
    }

    function supprimerChantier(){
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length){
        saveStatus.textContent = "Aucun chantier s√©lectionn√© √† supprimer.";
        return;
      }

      const ok = confirm("Supprimer ce chantier de la liste ? Cette action est d√©finitive sur cet appareil.");
      if (!ok) return;

      CHANTIERS.splice(idx, 1);

      try {
        localStorage.setItem("chantiersData_editable", JSON.stringify(CHANTIERS));
        localStorage.removeItem("chantier_pdf_" + idx);
      } catch (e) {
        console.warn("Impossible de mettre √† jour le localStorage :", e);
      }

      if (CHANTIERS.length === 0){
        etat.selectionIndex = null;
      } else {
        etat.selectionIndex = Math.min(idx, CHANTIERS.length - 1);
      }

      buildSyndicOptions();
      renderListe();
      renderDetail();
      saveStatus.textContent = "Chantier supprim√©.";
    }

    function updateCahierUI(){
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length) {
        cahierInfo.textContent = "";
        openCahierBtn.disabled = true;
        clearCahierBtn.disabled = true;
        infoCahierFile.value = "";
        return;
      }

      try {
        const stored = localStorage.getItem("chantier_pdf_" + idx);
        if (!stored) {
          cahierInfo.textContent = "Aucun cahier des charges PDF enregistr√© pour ce chantier.";
          openCahierBtn.disabled = true;
          clearCahierBtn.disabled = true;
        } else {
          const obj = JSON.parse(stored);
          const name = obj.name || "Cahier des charges PDF";
          cahierInfo.textContent = "PDF enregistr√© : " + name;
          openCahierBtn.disabled = false;
          clearCahierBtn.disabled = false;
        }
      } catch (e) {
        console.warn("Erreur lecture PDF chantier :", e);
        cahierInfo.textContent = "Impossible de lire les informations du cahier des charges.";
        openCahierBtn.disabled = true;
        clearCahierBtn.disabled = true;
      }
    }

    function updateCahierUIAfterDelete(deletedIndex){
      const newData = {};
      Object.keys(localStorage).forEach(key => {
        if (!key.startsWith("chantier_pdf_")) return;
        const idxStr = key.replace("chantier_pdf_", "");
        const idx = parseInt(idxStr, 10);
        if (isNaN(idx)) return;
        if (idx === deletedIndex) return;
        if (idx > deletedIndex) {
          newData["chantier_pdf_" + (idx - 1)] = localStorage.getItem(key);
        } else {
          newData[key] = localStorage.getItem(key);
        }
      });

      Object.keys(localStorage).forEach(key => {
        if (key.startsWith("chantier_pdf_")) {
          localStorage.removeItem(key);
        }
      });

      Object.keys(newData).forEach(key => {
        localStorage.setItem(key, newData[key]);
      });

      updateCahierUI();
    }

    searchInput.addEventListener("input", (e) => {
      etat.recherche = e.target.value;
      renderListe();
    });

    syndicFilter.addEventListener("change", (e) => {
      etat.syndic = e.target.value;
      renderListe();
    });

    triSelect.addEventListener("change", (e) => {
      etat.tri = e.target.value;
      renderListe();
    });

    saveButton.addEventListener("click", sauvegarderSelection);
    addChantierBtn.addEventListener("click", ajouterChantier);
    deleteChantierBtn.addEventListener("click", supprimerChantier);

    infoCahierFile.addEventListener("change", (e) => {
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length) {
        saveStatus.textContent = "S√©lectionne d‚Äôabord un chantier avant d‚Äôajouter un cahier des charges.";
        infoCahierFile.value = "";
        return;
      }

      const file = e.target.files[0];
      if (!file) return;

      if (file.type !== "application/pdf") {
        saveStatus.textContent = "Seuls les fichiers PDF sont accept√©s.";
        infoCahierFile.value = "";
        return;
      }

      const maxSize = 2 * 1024 * 1024;
      if (file.size > maxSize) {
        saveStatus.textContent = "PDF trop volumineux (max 2 Mo).";
        infoCahierFile.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(ev) {
        const dataUrl = ev.target.result;
        try {
          localStorage.setItem("chantier_pdf_" + idx, JSON.stringify({ name: file.name, dataUrl }));
          cahierInfo.textContent = "PDF enregistr√© : " + file.name;
          openCahierBtn.disabled = false;
          clearCahierBtn.disabled = false;
          saveStatus.textContent = "Cahier des charges PDF enregistr√© pour ce chantier.";
        } catch (err) {
          console.warn("Erreur en enregistrant le PDF :", err);
          saveStatus.textContent = "PDF trop lourd ou stockage indisponible.";
        }
      };
      reader.readAsDataURL(file);
    });

    openCahierBtn.addEventListener("click", () => {
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length) return;
      try {
        const stored = localStorage.getItem("chantier_pdf_" + idx);
        if (!stored) return;
        const obj = JSON.parse(stored);
        const dataUrl = obj.dataUrl;
        if (!dataUrl) return;
        window.open(dataUrl, "_blank");
      } catch (e) {
        console.warn("Erreur ouverture PDF :", e);
      }
    });

    clearCahierBtn.addEventListener("click", () => {
      const idx = etat.selectionIndex;
      if (idx === null || idx < 0 || idx >= CHANTIERS.length) return;
      const ok = confirm("Supprimer le cahier des charges PDF pour ce chantier ?");
      if (!ok) return;
      try {
        localStorage.removeItem("chantier_pdf_" + idx);
        infoCahierFile.value = "";
        cahierInfo.textContent = "Cahier des charges supprim√© pour ce chantier.";
        openCahierBtn.disabled = true;
        clearCahierBtn.disabled = true;
      } catch (e) {
        console.warn("Erreur suppression PDF :", e);
      }
    });

    buildSyndicOptions();
    renderListe();
    renderDetail();
  </script>
</body>
</html>
